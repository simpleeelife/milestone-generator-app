<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マイルストーン自動生成アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* スピナーアニメーション */
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .guideline-content {
            transition: max-height 0.5s ease-in-out;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-3xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-indigo-600">
                マイルストーン自動生成
            </h1>
            <p class="text-gray-400 mt-2">スキルとゴールを設定して、学習ロードマップを作成しよう</p>
        </header>

        <main class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-700">
            <div class="space-y-6">
                <!-- スキル名入力 -->
                <div>
                    <label for="skill-name" class="block text-sm font-medium text-gray-300 mb-2">習得したいスキル名</label>
                    <input type="text" id="skill-name" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="例: Webデザイン">
                </div>

                <!-- ゴール設定 -->
                <div>
                    <label for="goal" class="block text-sm font-medium text-gray-300 mb-2">最終的なゴール</label>
                    <textarea id="goal" rows="3" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="例: オリジナルのポートフォリオサイトを公開し、Webデザイナーとして案件を獲得する"></textarea>
                </div>

                <!-- 生成ボタン -->
                <button id="generate-button" class="w-full bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500">
                    <span id="button-text">10個のマイルストーンを生成する</span>
                </button>
            </div>

            <!-- アコーディオン形式のガイドラインエリア -->
            <div class="mt-6 border-t border-gray-700 pt-6">
                <button id="toggle-milestone-guideline-button" class="w-full text-left flex justify-between items-center text-indigo-400 hover:text-indigo-300 focus:outline-none">
                    <span class="font-semibold">マイルストーン設定ガイドラインと事例を表示する</span>
                    <svg id="milestone-guideline-arrow" class="w-5 h-5 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="milestone-guideline-content" class="guideline-content max-h-0 mt-4 text-gray-300 text-sm">
                    <div class="p-4 bg-gray-700/50 rounded-lg space-y-4 text-gray-300 text-sm">
                        <h3 class="font-bold text-lg mb-2 text-white">マイルストーン設定ガイドラインと事例</h3>
                        <p>良いマイルストーンは、基礎から応用、そして収益化へと繋がります。</p>
                        <div>
                            <h4 class="font-semibold text-white mb-2">ガイドライン</h4>
                            <ul class="list-disc list-inside space-y-1">
                                <li><span class="font-semibold text-green-400">Lv.1-3:</span> 基礎技術の習得</li>
                                <li><span class="font-semibold text-blue-400">Lv.4-6:</span> 応用・実践</li>
                                <li><span class="font-semibold text-yellow-400">Lv.7:</span> コンテンツ化</li>
                                <li><span class="font-semibold text-purple-400">Lv.8-9:</span> 商品化</li>
                                <li><span class="font-semibold text-red-400">Lv.10:</span> 収益化</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-white mt-4 mb-2">参考事例（音楽制作スキル）</h4>
                            <p><strong>スキル名:</strong> 音楽制作スキル</p>
                            <p><strong>ゴール:</strong> バーチャルミュージシャンとして収益を得る</p>
                            <h5 class="font-semibold text-white mt-3 mb-2">マイルストーン例:</h5>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>歌詞作成の基礎技術を習得し、オリジナル歌詞を複数作成する</li>
                                <li>SUNO AIの基本操作を習得し、簡単な楽曲を制作・公開する</li>
                                <li>バーチャルミュージシャンのキャラクター設定と楽曲コンセプトを明確化する</li>
                                <li>統一したボーカルスタイルを実現するプロンプト技術を確立する</li>
                                <li>一貫したテーマでアルバム（10曲程度）を制作・完成させる</li>
                                <li>SoundONを使って各音楽配信プラットフォームに公開し、リスナーからのフィードバックを得る</li>
                                <li>プロモーション戦略を立案・実行し、複数のアルバムをリリースする</li>
                                <li>安定した月間再生数の実績を構築し、ファンベースを形成する</li>
                                <li>「バーチャルミュージシャンの育て方」セミナーを開催し、参加者を集客する</li>
                                <li>「音楽生成AIで収益を得る方法」の教材を作成・販売し、月額10万円以上の安定収益を達成する</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- アコーディオン形式のガイドラインエリア -->
            <div class="mt-6 border-t border-gray-700 pt-6">
                <button id="toggle-guideline-button" class="w-full text-left flex justify-between items-center text-indigo-400 hover:text-indigo-300 focus:outline-none">
                    <span class="font-semibold">アプリ利用者ガイドライン（詳細版）を表示する</span>
                    <svg id="guideline-arrow" class="w-5 h-5 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="guideline-content" class="guideline-content max-h-0 mt-4 text-gray-300 text-sm">
                    <div class="p-4 bg-gray-700/50 rounded-lg space-y-6">
                        <section>
                            <h3 class="font-bold text-lg mb-2 text-white">🎯 1. このアプリについて</h3>
                            <p>このアプリは、あなたが習得したいスキルとその最終的なゴールを入力するだけで、AIが学習計画の指針となる<strong class="text-indigo-300">10個のマイルストーン（中間目標）</strong>を自動で生成するツールです。</p>
                        </section>
                        <section>
                            <h3 class="font-bold text-lg mb-2 text-white">✍️ 2. 基本的な使い方</h3>
                            <ol class="list-decimal list-inside space-y-2">
                                <li><strong>最終的なゴールを具体的に入力:</strong><br>そのスキルを使って、最終的に何を達成したいのかを具体的に記述します。<strong class="text-indigo-300">ここが最も重要です。</strong><br>
                                    <span class="text-red-400">悪い例 👎:</span> 「Webサイトを作れるようになりたい」<br>
                                    <span class="text-green-400">良い例 👍:</span> 「オリジナルのポートフォリオサイトを自分でデザイン・開発し、Webデザイナーとしてクラウドソーシングで月5万円の案件を獲得する」
                                </li>
                            </ol>
                        </section>
                        <section>
                            <h3 class="font-bold text-lg mb-2 text-white">💡 3. なぜ「収益化」が最終ゴールなのか？</h3>
                            <p>スキル習得の最終的な指標として「収益化」を置くことには、いくつかの重要な理由があります。これは単にお金儲けを目的とするのではなく、<strong class="text-indigo-300">あなたのスキルが本質的な価値を持つことの証明</strong>となるからです。</p>
                            <ul class="list-disc list-inside space-y-2 mt-2">
                                <li><strong>スキルの価値が「見える化」されるから:</strong><br>誰かがあなたの商品やサービスにお金を払うということは、そのスキルが他者の課題を解決し、役に立っている何よりの証拠です。</li>
                                <li><strong>「好きなことで生きていく」を実現するため:</strong><br>収益化は、あなたの情熱を持続可能なキャリアやライフワークに変えるための重要なステップです。スキルを磨くことが<strong class="text-indigo-300">自己実現と経済的な自立に直結</strong>します。</li>
                            </ul>
                        </section>
                    </div>
                </div>
            </div>

            <!-- ローディング表示 -->
            <div id="loading" class="hidden text-center py-8">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mx-auto mb-4"></div>
                <p class="text-gray-400">AIがマイルストーンを生成中です...</p>
            </div>
            
            <!-- エラー表示 -->
            <div id="error-message" class="hidden mt-6 bg-red-900/50 border border-red-500 text-red-300 px-4 py-3 rounded-lg">
                <p>エラーが発生しました。時間をおいて再度お試しください。</p>
            </div>

            <!-- 結果表示エリア -->
            <div id="result" class="hidden mt-8">
                <h2 class="text-2xl font-bold mb-6 border-l-4 border-indigo-500 pl-4">生成されたマイルストーン</h2>
                <div id="milestones-container" class="space-y-4">
                    <!-- マイルストーンがここに動的に追加される -->
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>Powered by Gemini API</p>
        </footer>
    </div>

    <script>
        const generateButton = document.getElementById('generate-button');
        const buttonText = document.getElementById('button-text');
        const skillNameInput = document.getElementById('skill-name');
        const goalInput = document.getElementById('goal');
        const loadingDiv = document.getElementById('loading');
        const resultDiv = document.getElementById('result');
        const milestonesContainer = document.getElementById('milestones-container');
        const errorMessageDiv = document.getElementById('error-message');
        const toggleGuidelineButton = document.getElementById('toggle-guideline-button');
        const guidelineContent = document.getElementById('guideline-content');
        const guidelineArrow = document.getElementById('guideline-arrow');

        const toggleMilestoneGuidelineButton = document.getElementById('toggle-milestone-guideline-button');
        const milestoneGuidelineContent = document.getElementById('milestone-guideline-content');
        const milestoneGuidelineArrow = document.getElementById('milestone-guideline-arrow');

        toggleMilestoneGuidelineButton.addEventListener('click', () => {
            if (milestoneGuidelineContent.style.maxHeight) {
                milestoneGuidelineContent.style.maxHeight = null;
                milestoneGuidelineArrow.classList.remove('rotate-180');
            } else {
                milestoneGuidelineContent.style.maxHeight = milestoneGuidelineContent.scrollHeight + "px";
                milestoneGuidelineArrow.classList.add('rotate-180');
            }
        });

        // ガイドライン開閉ボタンのイベントリスナー
        toggleGuidelineButton.addEventListener('click', () => {
            if (guidelineContent.style.maxHeight) {
                guidelineContent.style.maxHeight = null;
                guidelineArrow.classList.remove('rotate-180');
            } else {
                guidelineContent.style.maxHeight = guidelineContent.scrollHeight + "px";
                guidelineArrow.classList.add('rotate-180');
            }
        });

        // 生成ボタンクリック時のイベントリスナー
        generateButton.addEventListener('click', async () => {
            const skillName = skillNameInput.value.trim();
            const goal = goalInput.value.trim();

            if (!skillName || !goal) {
                alert('スキル名とゴールを両方入力してください。');
                return;
            }

            // UIを更新
            resultDiv.classList.add('hidden');
            errorMessageDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');
            generateButton.disabled = true;
            buttonText.textContent = '生成中...';

            try {
                // Gemini APIを呼び出し
                const milestones = await generateMilestones(skillName, goal);
                displayMilestones(milestones);
            } catch (error) {
                console.error('Error generating milestones:', error);
                errorMessageDiv.classList.remove('hidden');
            } finally {
                // UIを元に戻す
                loadingDiv.classList.add('hidden');
                generateButton.disabled = false;
                buttonText.textContent = '10個のマイルストーンを生成する';
            }
        });

        /**
         * APIを呼び出してマイルストーンを生成する関数
         * @param {string} skillName - 習得したいスキル名
         * @param {string} goal - 最終的なゴール
         * @returns {Promise<Array<object>>} - 生成されたマイルストーンの配列
         */
        async function generateMilestones(skillName, goal) {
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ skillName, goal }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'API request failed');
                }

                const data = await response.json();
                return data.milestones;

            } catch (error) {
                console.error('Error calling API:', error);
                throw error;
            }
        }

        /**
         * 生成されたマイルストーンを画面に表示する関数
         * @param {Array<object>} milestones - マイルストーンの配列
         */
        function displayMilestones(milestones) {
            milestonesContainer.innerHTML = ''; // 以前の結果をクリア

            if (!milestones || milestones.length === 0) {
                errorMessageDiv.classList.remove('hidden');
                errorMessageDiv.textContent = 'マイルストーンを生成できませんでした。';
                return;
            }

            milestones.forEach((item, index) => {
                const milestoneElement = document.createElement('div');
                milestoneElement.className = 'flex items-start space-x-4 p-4 bg-gray-700/50 rounded-lg border border-gray-600/50';
                
                const levelColor = getLevelColor(item.level);

                milestoneElement.innerHTML = `
                    <div class="flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-full ${levelColor.bg} text-white font-bold text-lg">
                        ${item.level}
                    </div>
                    <div class="flex-1">
                        <p class="text-gray-100 leading-relaxed">${item.milestone}</p>
                    </div>
                `;
                milestonesContainer.appendChild(milestoneElement);
            });

            resultDiv.classList.remove('hidden');
        }

        /**
         * マイルストーンのレベルに応じて色を返すヘルパー関数
         * @param {number} level - マイルストーンのレベル
         * @returns {{bg: string}} - Tailwind CSSの背景色クラス
         */
        function getLevelColor(level) {
            if (level >= 1 && level <= 3) {
                return { bg: 'bg-green-600' }; // 基礎
            } else if (level >= 4 && level <= 6) {
                return { bg: 'bg-blue-600' }; // 応用
            } else if (level === 7) {
                return { bg: 'bg-yellow-600' }; // コンテンツ化
            } else if (level >= 8 && level <= 9) {
                return { bg: 'bg-purple-600' }; // 商品化
            } else {
                return { bg: 'bg-red-600' }; // 収益化
            }
        }
    </script>
</body>
</html>
